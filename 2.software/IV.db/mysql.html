<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/my_notes/styles/note_style.css" rel="stylesheet" type="text/css">
    <link href="../../styles/note_style.css" rel="stylesheet" type="text/css">
    <link rel="icon" href="/my_notes/logo/software.png">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
      $(function(){
        $(".navi_span_home").load("/my_notes/navigations/navi_bar_home.html");
        $(".navi_span").load("/my_notes/navigations/navi_bar_2.html");
      });
    </script>
    <title>mySQL</title>
    <style>
      header{ background-image: linear-gradient( 90deg, #0a253e 10%, #2d5b7c 100%); }
      li.navi a#IV{background-color: #4CAF50;} /* which one be green */
    </style>
  </head>
<!-------------------------------------------------->
  <body>
    <header>
      <p onclick="hidebar()" id="title">mySQL</p>
    </header>
    <ul class="navi">
      <span class="navi_span_home"></span>
      <span class="navi_span"></span>
    </ul>
<!--D1----------------------------------------------> 
    <div class="block" onclick="hidebar()">


    <h2>mySQL</h2>
      <p>SQL is <span class="high">not case sensitive</span> 的，以下是語法：</p>

      <h3>Basic retrieve</h3>
        <table>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> dept;</td>
            <td>show 所有 column</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> manager_id, location_id<br><span class="sql">from</span> departments;</td>
            <td>show 指定的 column</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> ename, sal, sal+500<br><span class="sql">from</span> emp;</td>
            <td>對 column 運算</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> ename as name, sal old, sal+50 "NEW"<br><span class="sql">from</span> emp;</td>
            <td>set Alias</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql">describe</span> dept;</td>
            <td>show table 內有甚麼 column</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql">select distinct</span> deptno <span class="sql">from</span> emp;</td>
            <td>show column 入面有甚麼種類</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql">select distinct</span>   vend_id, prod_price<br><span class="sql">from</span> products;</td>
            <td>兩個都一樣先 dedup</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;">--</td>
            <td>leave comment</td>
          </tr>
        </table>

      <h3>Restriction</h3>
        <table>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> emp<br><span class="sql">where</span> sal < 8000;</td>
            <td>數值，不用 quote</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> emp<br><span class="sql">where</span> ename = 'KING';</td>
            <td>注意！標題用 double quote，字串用 single quote！</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> emp<br><span class="sql">where</span> hiredate >= '1983-01-01';</td>
            <td></td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> emp<br><span class="sql">where</span> mgr is null;</td>
            <td>null 用 is, 或者 is not</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> emp<br><span class="sql">where</span> hiredate > '1982'<br><span class="sql">and</span> sal >1200<br><span class="sql">and</span> job ='clerk';</td>
            <td>and, or, not</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> products<br><span class="sql">where</span> (A <span class="sql">and</span> B) <span class="sql">or</span> (C <span class="sql">and</span> E <span class="sql">and</span> F);</td>
            <td>如果有多個邏輯，可以用括號區分級別</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> ename, sal <span class="sql">from</span> emp<br><span class="sql">where</span> sal <span class="sql">between</span> 1000 <span class="sql">and</span> 1500;</td>
            <td>[1000,1500]</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> empno, ename, sal, mgr <span class="sql">from</span> emp<br><span class="sql">where</span> mgr <span class="sql">in</span> (7902, 7566);</td>
            <td>是給出的實際值</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql">select</span> ename <span class="sql">from</span> emp<br><span class="sql">where</span> ename <span class="sql">like</span> 's%';</td>
            <td>% 是任何個數的糢糊值</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql">select</span> ename <span class="sql">from</span> emp<br><span class="sql">where</span> ename <span class="sql">like</span> 's_';</td>
            <td>_ 一個單位的糢糊值</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql">select</span> ename <span class="sql">from</span> emp<br><span class="sql">where</span> ename <span class="sql">like</span> 'a%n';</td>
            <td></td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql">select</span> ename <span class="sql">from</span> emp<br><span class="sql">where</span> ename <span class="sql">like</span> 'S\_%';</td>
            <td>如果真係想 search 下加線，可以用 \_</td>
          </tr>
        </table>

      <h3>Order</h3>
        <table> <!-- Order -->
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> emp<br><span class="sql">order by</span> sal <span class="sql">desc</span>;</td>
            <td>descendent 由大到細, default 係由細到大</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> emp<br><span class="sql">order by</span> deptno, sal <span class="sql">desc</span>;</td>
            <td>先排 deptno, 後排 sal</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> * <span class="sql">from</span> emp<br><span class="sql">order by</span> 3;</td>
            <td>排第三個 column</td>
          </tr>
        </table>

      <h3>Null</h3>
        <table> <!-- Null -->
          <tr>
            <td colspan="2">任何野加減乘除 null，結果都係 null</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">ifnull</span>(comm, 0)</td>
            <td>如果 comm 是 null 時，值為 0</td>
          </tr>
          <tr>
            <td colspan="2" style="text-align: left;"><span class="sql">select</span> ename, sal, <span class="sql_b">ifnull</span>(comm, 0), sal + <span class="sql_b">ifnull</span>(comm, 0) <span class="sql">from</span> emp;</td>
          </tr>
        </table>

      <h3>Text manipulation</h3>
        <table> <!-- Text manipulation -->
          <tr>
            <td style="text-align: left;"><span class="sql_b">concat</span>('A',' ','B')</td>
            <td>A B</td>
            <td>合拼文字</td>
          </tr>
          <tr>
            <td style="text-align: left;" colspan="3"><span class="sql">select</span> <span class="sql_b">concat</span>(first_name, ' ', last_name) <span class="sql">from</span> employees;</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">length</span>('eugene')</td>
            <td>6</td>
            <td>計長度</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">upper</span>(ename)</td>
            <td>SMITH</td>
            <td>變大草</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">lower</span>('ABC')</td>
            <td>abc</td>
            <td>變小草</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">lpad</span>('hello', 7, '*')</td>
            <td>**hello</td>
            <td>顯示固定長度(7位)，左邊補*</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">lpad</span>('hello', 1, '*')</td>
            <td>h</td>
            <td></td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">rpad</span>('rose', 7, '?')</td>
            <td>rose???</td>
            <td>顯示固定長度(7位)，右邊補?</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">substring</span>('rosemary', 5, 4)</td>
            <td>mary</td>
            <td>由第 5 位開始取 4 個位</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">ltrim</span>(' rose')</td>
            <td>rose</td>
            <td>左邊去空格，無論多少個</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">rtrim</span>('rose ')</td>
            <td>rose</td>
            <td>右邊去空格，無論多少個</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">replace</span>('www', 'w', 'W')</td>
            <td>WWW</td>
            <td></td>
          </tr>
        </table>

      <h3>Number manipulation</h3>
        <table> <!-- Number manipulation -->
          <tr>
            <td style="text-align: left;"><span class="sql_b">ceiling</span>(1.23)</td>
            <td>1</td>
            <td>下一個整數</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">floor</span>(-1.23)</td>
            <td>-2</td>
            <td>上一個整數</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">power</span>(2,3)</td>
            <td>8</td>
            <td>2^3</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">round</span>(5.49, 1)</td>
            <td>5.5</td>
            <td>四捨五入，1是小數點後位置</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">round</span>(24.49, -1)</td>
            <td>20</td>
            <td>小數點前一位</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">truncate</span>(101.6, 0)</td>
            <td>101</td>
            <td>取整</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">greatest</span>(5,3,1)</td>
            <td>5</td>
            <td>揀最大</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">least</span>()</td>
            <td></td>
            <td>揀最小</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">rand</span>()</td>
            <td></td>
            <td>隨機數</td>
          </tr>
        </table>

      <h3>Date manipulation</h3>
        <table> <!-- Date manipulation -->
          <tr>
            <td style="text-align: left;"><span class="sql_b">now</span>()</td>
            <td>2019-07-19 23:40:58</td>
            <td>年月日時分秒</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">curdate</span>()</td>
            <td>2019-07-19</td>
            <td>日子</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">curtime</span>()</td>
            <td>23:42:46</td>
            <td>時間</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">adddate</span>(<span class="sql_b">now</span>(),3)</td>
            <td>2019-07-22 23:43:22</td>
            <td>加三日</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">adddate</span>(<span class="sql_b">now</span>(), <span class="sql">interval</span> 10 year)</td>
            <td>2029-07-19 23:43:47</td>
            <td>十年後</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">subdate</span>(<span class="sql_b">now</span>(), 7)</td>
            <td>2019-07-12 23:44:16</td>
            <td>減七日</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql_b">datediff</span>(date1, date2)</td>
            <td></td>
            <td>date1 減 date2</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;"><span class="sql_b">datediff</span>(<span class="sql_b">curdate</span>(), hiredate)</td>
            <td></td>
            <td>returns in days</td>
          </tr>
          <tr>
            <td style="text-align: left;">last_day('2003-02-05')</td>
            <td>2003-02-28</td>
            <td>查該月最後一日</td>
          </tr>
          <tr>
            <td style="text-align: left;">last_day(hiredate)</td>
            <td>1980-12-31</td>

            <td></td>
          </tr>
        </table>

      <h3>Conversion (Num ↔ String)</h3>
        <table> <!-- Conversion (Num ↔ String) -->
          <tr>
            <td style="text-align: left;"><span class="sql">convert</span>(3/4, <span class="sql">char</span>(3))</td>
            <td>0.7</td>
            <td>Num to String(3-digit)</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">convert</span>('10.1234', <span class="sql">decimal</span>(5,3))</td>
            <td>10.123</td>
            <td>5 是小數點左右一共位數；3 是小數點右位數</td>
          </tr>
        </table>

      <h3>Conversion (Date ↔ String)</h3>
        <table> <!-- Conversion (Date ↔ String) -->
          <tr>
            <td style="text-align: left;"><span class="sql_b">date_format</span>(<span class="sql_b">now</span>(), '%Y.%m.%d')</td>
            <td>2012.01.12</td>
            <td><a href="https://www.w3schools.com/sql/func_mysql_date_format.asp">日期變文字</a></td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">date_format</span>(hiredate, '%M %d, %Y')</td>
            <td>Februray 22, 1988</td>
            <td></td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">extract</span>(year <span class="sql">from</span> '2009-07-02')</td>
            <td>2009</td>
            <td><a href="https://www.w3schools.com/sql/func_mysql_extract.asp">抽取</a></td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql_b">extract</span>(quarter <span class="sql">from</span> hiredate)</td>
            <td>4</td>
            <td>季度</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;">str_to_date('February 22, 1988', '%M %d, %Y')</td>
            <td>1988-02-22</td>
            <td>文字變日期</td>
          </tr>
        </table>

      <h3>Aggregating data</h3>
        <p>結果只顯示一行 row，因此吾好 show 這 5 個 function 以外的 column。</p>
        <table> <!-- Aggregating data -->
          <tr>
            <td style="text-align: left;">avg(sal)</td>
            <td>平均值</td>
          </tr>
          <tr>
            <td style="text-align: left;">count(sal)</td>
            <td>有 sal 值的個數</td>
          </tr>
          <tr>
            <td style="text-align: left;">max(sal)</td>
            <td>最大</td>
          </tr>
          <tr>
            <td style="text-align: left;">min(sal)</td>
            <td>最小</td>
          </tr>
          <tr>
            <td style="text-align: left;">sum(sal)</td>
            <td>總數</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> avg(sal), count(sal), max(sal), min(sal), sum(sal) <span class="sql">from</span> emp<br><span class="sql">where</span> job <span class="sql">like</span> 'clerk';</td>
            <td>先找出所有 clerk，計平均月薪、個數﹑最大最小月薪﹑月薪總和</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;">count(*)</td>
            <td>包括null</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;">count(comm)</td>
            <td>有值先 count</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;">avg(<span class="sql_b">ifnull</span>(comm, 0))</td>
            <td>標準寫法</td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;" colspan="2"><span class="sql">select</span> avg(<span class="sql_b">ifnull</span>(sal,0)), min(<span class="sql_b">ifnull</span>(sal,0)), max(<span class="sql_b">ifnull</span>(sal,0)), count(<span class="sql_b">ifnull</span>(sal,0)), sum(<span class="sql_b">ifnull</span>(sal,0)) ...</td>
          </tr>
        </table>

      <h3>Group by</h3>
        <table> <!-- Group -->
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> deptno, avg(sal), max(sal), sum(sal) <span class="sql">from</span> emp<br><span class="sql">group by</span> deptno;</td>
            <td>按不同部門分 group，都產生一系列數據</td>
          </tr>
          <tr>
            <td style="text-align: left;"><span class="sql">select</span> deptno, avg(sal), max(sal), sum(sal) <span class="sql">from</span> emp<br><span class="sql">group by</span> deptno<br><span class="sql">having</span> avg(sal) > 2000;</td>
            <td>不同部門都生一堆數據，然後再 filter 一次，只顯示平均收入高過 2000 的</td>
          </tr>
        </table>

      <h3>Subquery</h3>
        <table>
          <tr>
            <td rowspan="2">Single</td>
            <td style="text-align: left;">
              <span class="sql">select</span> ename, deptno <span class="sql">from</span> emp<br> 
              <span class="sql">where</span> deptno = <br>
              (<span class="sql">select</span> deptno <span class="sql">from</span> emp <br>
              <span class="sql">where</span> ename='king'); 
            </td>
          </tr>
          <tr>
            <td style="text-align: left;">
              <span class="sql">select</span> * <span class="sql">from</span> emp <br>
              <span class="sql">where</span> sal > <br>
              (<span class="sql">select</span> avg(<span class="sql_b">ifnull</span>(sal, 0)) <span class="sql">from</span> emp)<br>
              <span class="sql">and</span> hiredate < <br>
              (<span class="sql">select</span> hiredate <span class="sql">from</span> emp <span class="sql">where</span> ename = 'james') <br>
              <span class="sql">order by</span> sal <span class="sql">desc</span>;
            </td>
          </tr>
          <tr style="background-color: #dadada">
            <td rowspan="3">Multiple</td>
            <td style="text-align: left;">
              <span class="sql">select</span> * <span class="sql">from</span> employees<br>
              <span class="sql">where</span> salary > <span class="sql">all</span><br>
              (<span class="sql">select</span> avg(salary) <span class="sql">from</span> employees<br>
              <span class="sql">group by</span> department_id);
            </td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;">
              &#60;<span class="sql">any</span>, means less than the maximum<br>
              &#62;<span class="sql">any</span>, means more than the minimum<br>
              =<span class="sql">any</span>, is equivalent to <span class="sql">IN</span>
            </td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;">
              &#60;<span class="sql">all</span>, means less than the minimum<br>
              &#62;<span class="sql">all</span>, means more than the maximum<br>
              =<span class="sql">all</span>, meaningless              
            </td>
          </tr>
        </table>

      <h3>Multiple Tables</h3>
        <table>
          <tr>
            <td rowspan="2">
              ANSI SQL 1992
            </td>
            <td style="text-align: left;">
              <span class="sql">select</span> emp.empno, emp.ename, emp.sal, dept.dname <br>
              <span class="sql">from</span> emp, dept <br>
              <span class="sql">where</span> emp.deptno= dept.deptno; 
            </td>
          </tr>
          <tr>
            <td style="text-align: left;">
              <span class="sql">select</span> e.first_name, e.last_name, d.department_name, <br>
              l.city, c.country_name, r.region_name <br>
              <span class="sql">from</span> employees e, departments d, locations l, <br>
              countries c, regions r <br>
              <span class="sql">where</span> e.department_id = d.department_id <br>
              <span class="sql">and</span> d.location_id = l.location_id <br>
              <span class="sql">and</span> l.country_id = c.country_id <br>
              <span class="sql">and</span> c.region_id = r.region_id; 
            </td>
          </tr>
          <tr style="background-color: #dadada">
            <td rowspan="3">
              ANSI SQL 1999
            </td>
            <td style="text-align: left;">
              <span class="sql">select</span> emp.empno, emp.ename, emp.sal, dept.dname <br>
              <span class="sql">from</span> emp<br>
              <span class="sql">join</span> dept <span class="sql">on</span> emp.deptno = dept.deptno; 
            </td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;">
              <span class="sql">select</span> e.first_name, e.last_name, d.department_name, <br>
              l.city, c.country_name, r.region_name <br>
              <span class="sql">from</span> employees e <br>
              <span class="sql">join</span> departments d <span class="sql">on</span> e.department_id = d.department_id <br>
              <span class="sql">join</span> locations l <span class="sql">on</span> d.location_id = l.location_id <br>
              <span class="sql">join</span> countries c <span class="sql">on</span> l.country_id = c.country_id <br>
              <span class="sql">join</span> regions r <span class="sql">on</span> r.region_id = c.region_id; 
            </td>
          </tr>
          <tr style="background-color: #dadada">
            <td style="text-align: left;">
              <span class="sql">select</span> e.empno, e.ename, e.sal, s.grade, s.losal, s.hisal <br>
              <span class="sql">from</span> emp e <br>
              <span class="sql">join</span> salgrade s <span class="sql">on</span> e.sal <span class="sql">between</span> s.losal <span class="sql">and</span> s.hisal;
            </td>
          </tr>
        </table>

      <h3>Left outer join</h3>
        <p>有些情況左邊 table 的個別記錄，在右邊 table 上內容是 null，預設 join 了兩張 table 後整筆記錄不顯示，若要使左邊 table 所有記錄都顯示出來，需要用 "left outer join"：</p>
        <table>
          <tr>
            <td style="text-align: left;">
              <span class="sql">select</span> e.employee_id, e.first_name, e.department_id, d.department_name<br>
              <span class="sql">from</span> employees e<br>
              <span class="sql">left outer join</span> departments d <span class="sql">on</span> e.department_id = d.department_id;
            </td>
          </tr>
        </table>
        <p>
          ● 所以當有些員工沒有填 department_id，也不至於消失在表上。<br>
          ● 它只忽視下一個 table，換句話說再下一個 table 是 null，這個記錄依然消失。因此一用 outer join，就所有行都用晒才有意思。
        </p>



    </div>
<!--------------------------------------------------> 
    <button onclick="topFunction()" id="TopBtn" title="Go to top">T</button> 
    <script>
      function hidebar(){
        $(function(){
        $(".navi_span_home").load("/my_notes/navigations/navi_bar_home.html");
        $(".navi_span").load("/my_notes/navigations/navi_bar_2.html");
      });
      };

      // When the user scrolls down 520px from the top of the document, show the button
      window.onscroll = function() {scrollFunction()};
      function scrollFunction() {
        if (document.body.scrollTop > 520 || document.documentElement.scrollTop > 520) {
          document.getElementById("TopBtn").style.display = "block";
        } else {
          document.getElementById("TopBtn").style.display = "none";
        }
      };

      // When the user clicks on the button, scroll to the top of the document
      function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
      };
    </script>  
  </body>
</html>



















